{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h5 class="mb-0">Notifications</h5>
  <div class="d-flex align-items-center gap-2">
    <a class="btn btn-outline-secondary btn-sm {{ status == 'unread' and 'active' or '' }}" href="{{ url_for('notifications_list', status='unread') }}">Unread</a>
    <a class="btn btn-outline-secondary btn-sm {{ status == 'all' and 'active' or '' }}" href="{{ url_for('notifications_list', status='all') }}">All</a>
    <form method="post" action="{{ url_for('mark_all_notifications_read') }}" class="ms-2">
      <button class="btn btn-sm btn-link" type="submit">Mark all read</button>
    </form>
  </div>
</div>

{% if total == 0 %}
  <div class="alert alert-info">No {{ status }} notifications.</div>
{% else %}
  <div class="list-group">
    {% for n in items %}
      <div class="list-group-item d-flex justify-content-between align-items-start {{ n.is_read and 'opacity-75' or '' }}">
        <div class="me-3">
          <div class="small">{{ n.message }}</div>
          <div class="text-muted small">{{ n.created_at|fmt_ist('%d %b %Y, %I:%M %p') }}</div>
        </div>
        <div class="d-flex align-items-center gap-2">
          {% if n.ticket_id %}
            <a class="btn btn-sm btn-primary" href="{{ url_for('go_notification', nid=n.id) }}">Open</a>
          {% endif %}
          {% if not n.is_read %}
            <form method="post" action="{{ url_for('mark_notification_read', nid=n.id) }}">
              <button class="btn btn-sm btn-outline-secondary" type="submit">Mark read</button>
            </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  <nav aria-label="Notifications pagination" class="mt-3">
    <ul class="pagination mb-0">
      <li class="page-item {{ page <= 1 and 'disabled' or '' }}">
        <a class="page-link" href="{{ url_for('notifications_list', status=status, page=page-1) }}" tabindex="-1">Previous</a>
      </li>
      {% for p in range(1, pages + 1) %}
        <li class="page-item {{ p == page and 'active' or '' }}">
          <a class="page-link" href="{{ url_for('notifications_list', status=status, page=p) }}">{{ p }}</a>
        </li>
      {% endfor %}
      <li class="page-item {{ page >= pages and 'disabled' or '' }}">
        <a class="page-link" href="{{ url_for('notifications_list', status=status, page=page+1) }}">Next</a>
      </li>
    </ul>
  </nav>
{% endif %}
{% endblock %}
